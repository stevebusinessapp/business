<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Receipt Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
        }
    
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
        }
    
        .container {
            max-width: 1200px;
        }
    
        .receipt-editor {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 30px;
        }
    
        .receipt {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
            position: relative;
        }
    
        .receipt-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
    
        .company-logo {
            max-width: 150px;
            max-height: 150px;
            margin-bottom: 15px;
        }
    
        .company-info {
            flex: 1;
            min-width: 200px;
            padding-right: 20px;
            max-width: 300px;
        }
    
        /* Improved address text wrapping */
        #receiptCompanyAddress,
        #receiptRecipientAddress {
            white-space: pre-line;
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 250px;
        }
    
        .recipient-info {
            max-width: 300px;
            word-wrap: break-word;
        }
    
        .receipt-title {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            margin: 20px 0;
            color: var(--primary-color);
        }
    
        .account-cards {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
    
        .account-card {
            flex: 1;
            min-width: 250px;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background-color: #f9f9f9;
        }
    
        .receipt-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
    
        .receipt-meta-item {
            margin-bottom: 10px;
            min-width: 200px;
        }
    
        /* Improved table layout for better text wrapping */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            table-layout: fixed;
        }
    
        th,
        td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 200px;
        }
    
        /* Specific column widths for better control */
        .receipt table th:nth-child(1),
        .receipt table td:nth-child(1) {
            width: 20%;
        }
    
        .receipt table th:nth-child(2),
        .receipt table td:nth-child(2) {
            width: 35%;
            white-space: pre-line;
        }
    
        .receipt table th:nth-child(3),
        .receipt table td:nth-child(3) {
            width: 15%;
        }
    
        .receipt table th:nth-child(4),
        .receipt table td:nth-child(4),
        .receipt table th:nth-child(5),
        .receipt table td:nth-child(5) {
            width: 15%;
        }
    
        th {
            background-color: var(--primary-color);
            color: white;
        }
    
        .total-section {
            margin-left: auto;
            width: 300px;
        }
    
        .total-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
    
        .grand-total {
            font-weight: bold;
            font-size: 18px;
            color: var(--accent-color);
            border-top: 2px solid #ddd;
            padding-top: 10px;
        }
    
        /* Improved payment terms text wrapping */
        #receiptPaymentTerms {
            white-space: pre-line;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
    
        .thank-you {
            text-align: center;
            margin: 30px 0;
            font-size: 18px;
            color: var(--primary-color);
        }
    
        .signatures {
            display: flex;
            justify-content: space-between;
            margin-top: 50px;
            flex-wrap: wrap;
        }
    
        .signature-box {
            text-align: center;
            min-width: 200px;
            margin-bottom: 20px;
        }
    
        .signature-line {
            width: 200px;
            border-bottom: 1px solid #000;
            margin: 50px auto 10px;
        }
    
        .signature-img {
            max-width: 150px;
            max-height: 80px;
            margin-bottom: 10px;
        }
    
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
    
        .btn-danger {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
        }
    
        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(52, 152, 219, 0.25);
        }
    
        .product-row td {
            vertical-align: middle;
        }
    
        /* Improved text wrapping for product description in editor */
        .product-description {
            white-space: pre-line;
            word-wrap: break-word;
        }
    
        .product-actions {
            display: flex;
            gap: 5px;
        }
    
        .naira {
            font-family: Arial, sans-serif;
        }
    
        .naira::before {
            content: "₦";
        }
    
        /* Style for cost input with Naira symbol */
        .cost-input-container {
            position: relative;
        }
    
        .cost-input-container::before {
            content: "₦";
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
        }
    
        .cost-input-container input {
            padding-left: 25px;
        }
    
        @media print {
            .no-print {
                display: none !important;
            }
    
            body {
                background-color: white;
            }
    
            .receipt {
                box-shadow: none;
                padding: 0;
            }
    
            .container {
                max-width: 100%;
                width: 100%;
            }
        }
    </style>


</head>

<body>
    <div class="container my-5">
        <div class="row">
            <div class="col-12">
                <div class="receipt-editor no-print">
                    <h2 class="mb-4">Receipt Editor</h2>

                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="companyLogo" class="form-label">Company Logo</label>
                                <input type="file" class="form-control" id="companyLogo" accept="image/*">
                            </div>
                            <div class="mb-3">
                                <label for="companyName" class="form-label">Company Name</label>
                                <input type="text" class="form-control" id="companyName"
                                    placeholder="Enter company name">
                            </div>
                            <div class="mb-3">
                                <label for="companyAddress" class="form-label">Company Address</label>
                                <textarea class="form-control" id="companyAddress" rows="2"
                                    placeholder="Enter company address"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="companyPhone" class="form-label">Company Phone</label>
                                <input type="text" class="form-control" id="companyPhone"
                                    placeholder="Enter company phone">
                            </div>
                            <div class="mb-3">
                                <label for="companyEmail" class="form-label">Company Email</label>
                                <input type="email" class="form-control" id="companyEmail"
                                    placeholder="Enter company email">
                            </div>
                            <div class="mb-3">
                                <label for="companyWebsite" class="form-label">Company Website</label>
                                <input type="text" class="form-control" id="companyWebsite"
                                    placeholder="Enter company website">
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="recipientName" class="form-label">Recipient Name</label>
                                <input type="text" class="form-control" id="recipientName"
                                    placeholder="Enter recipient name">
                            </div>
                            <div class="mb-3">
                                <label for="recipientAddress" class="form-label">Recipient Address</label>
                                <textarea class="form-control" id="recipientAddress" rows="2"
                                    placeholder="Enter recipient address"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="transactionDate" class="form-label">Transaction Date</label>
                                <input type="datetime-local" class="form-control" id="transactionDate">
                            </div>
                            <div class="mb-3">
                                <label for="receiptNumber" class="form-label">Receipt Number</label>
                                <input type="text" class="form-control" id="receiptNumber"
                                    placeholder="Enter receipt number">
                            </div>
                            <div class="mb-3">
                                <label for="lopNumber" class="form-label">L.O.P Number (Optional)</label>
                                <input type="text" class="form-control" id="lopNumber" placeholder="Enter L.O.P number">
                            </div>
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h5>Account Details 1</h5>
                            <div class="mb-3">
                                <label for="accountName1" class="form-label">Account Name</label>
                                <input type="text" class="form-control" id="accountName1"
                                    placeholder="Enter account name">
                            </div>
                            <div class="mb-3">
                                <label for="accountNumber1" class="form-label">Account Number</label>
                                <input type="text" class="form-control" id="accountNumber1"
                                    placeholder="Enter account number">
                            </div>
                            <div class="mb-3">
                                <label for="bankName1" class="form-label">Bank Name</label>
                                <input type="text" class="form-control" id="bankName1" placeholder="Enter bank name">
                            </div>
                        </div>

                        <div class="col-md-6">
                            <h5>Account Details 2</h5>
                            <div class="mb-3">
                                <label for="accountName2" class="form-label">Account Name</label>
                                <input type="text" class="form-control" id="accountName2"
                                    placeholder="Enter account name">
                            </div>
                            <div class="mb-3">
                                <label for="accountNumber2" class="form-label">Account Number</label>
                                <input type="text" class="form-control" id="accountNumber2"
                                    placeholder="Enter account number">
                            </div>
                            <div class="mb-3">
                                <label for="bankName2" class="form-label">Bank Name</label>
                                <input type="text" class="form-control" id="bankName2" placeholder="Enter bank name">
                            </div>
                        </div>
                    </div>

                    <h5 class="mb-3">Products</h5>
                    <div class="table-responsive mb-3">
                        <table class="table table-bordered" id="productsTable">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Description</th>
                                    <th>Quantity</th>
                                    <th>Unit Cost (₦)</th>
                                    <th>Total (₦)</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="productsList">
                                <!-- Products will be added here -->
                            </tbody>
                        </table>
                    </div>

                    <button type="button" class="btn btn-primary mb-4" id="addProductBtn">
                        <i class="fas fa-plus"></i> Add Product
                    </button>

                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="vatRate" class="form-label">VAT Rate (%)</label>
                                <input type="number" class="form-control" id="vatRate" placeholder="Enter VAT rate"
                                    min="0" max="100" oninput="calculateTotals()">
                            </div>
                            <div class="mb-3">
                                <label for="paymentTerms" class="form-label">Payment Terms</label>
                                <textarea class="form-control" id="paymentTerms" rows="2"
                                    placeholder="Enter payment terms"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="paymentTermsAmount" class="form-label">Payment Terms Amount (%)</label>
                                <div class="cost-input-container">
                                    <input type="number" class="form-control" id="paymentTermsAmount" placeholder="0.00"
                                        min="0" oninput="calculateTotals()">
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="thankYouMessage" class="form-label">Thank You Message</label>
                                <input type="text" class="form-control" id="thankYouMessage"
                                    placeholder="Enter thank you message" value="Thank you for your patronage!">
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="authorizedSignature" class="form-label">Authorized Signature</label>
                                <input type="file" class="form-control" id="authorizedSignature" accept="image/*">
                            </div>
                            <div class="mb-3">
                                <label for="authorizedName" class="form-label">Authorized Name</label>
                                <input type="text" class="form-control" id="authorizedName"
                                    placeholder="Enter authorized name">
                            </div>
                            <div class="mb-3">
                                <label for="customerSignature" class="form-label">Customer Signature (Optional)</label>
                               
                                <input type="file" class="form-control" id="customerSignature" accept="image/*">
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <button type="button" class="btn btn-primary" id="updateReceiptBtn">
                            <i class="fas fa-sync-alt"></i> Update Receipt
                        </button>
                        <button type="button" class="btn btn-success" id="printReceiptBtn">
                            <i class="fas fa-print"></i> Print Receipt
                        </button>
                    </div>
                </div>
                
                <div class="receipt" id="receipt">
                    <div class="receipt-header">
                        <div class="company-info">
                            <img src="" alt="Company Logo" class="company-logo" id="receiptCompanyLogo">
                            <h2 id="receiptCompanyName"></h2>
                            <p id="receiptCompanyAddress"></p>
                            <p id="receiptCompanyPhone"></p>
                            <p id="receiptCompanyEmail"></p>
                            <p id="receiptCompanyWebsite"></p>
                        </div>
                        <div class="recipient-info">
                            <h5>Bill To:</h5>
                            <p id="receiptRecipientName"></p>
                            <p id="receiptRecipientAddress"></p>
                        </div>
                    </div>
                    
                    <h1 class="receipt-title">RECEIPT</h1>
                    
                    <div class="receipt-meta">
                        <div class="receipt-meta-item">
                            <strong>Date:</strong> <span id="receiptTransactionDate"></span>
                        </div>
                        <div class="receipt-meta-item">
                            <strong>Receipt #:</strong> <span id="receiptReceiptNumber"></span>
                        </div>
                        <div class="receipt-meta-item" id="lopNumberContainer">
                            <strong>L.O.P #:</strong> <span id="receiptLopNumber"></span>
                        </div>
                    </div>
                    

                    
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Description</th>
                                    <th>Quantity</th>
                                    <th>Unit Cost (₦)</th>
                                    <th>Total (₦)</th>
                                </tr>
                            </thead>
                            <tbody id="receiptProductsList">
                                <!-- Products will be added here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="total-section">
                        <div class="total-row">
                            <span>Subtotal:</span>
                            <span class="naira" id="receiptSubtotal">0.00</span>
                        </div>
                        <div class="total-row" id="vatContainer">
                            <span>VAT (<span id="receiptVatRate">0</span>%):</span>
                            <span class="naira" id="receiptVat">0.00</span>
                        </div>
                        <div class="total-row" id="paymentTermsAmountContainer">
                            <span>Payment Terms:</span>
                            <span class="naira" id="receiptPaymentTermsAmount">0.00</span>
                        </div>
                        <div class="total-row grand-total">
                            <span>Grand Total:</span>
                            <span class="naira" id="receiptGrandTotal">0.00</span>
                        </div>
                    </div>
                    
                    <div id="paymentTermsContainer">
                        <h5>Payment Terms:</h5>
                        <p id="receiptPaymentTerms"></p>
                    </div>
                    
                    <div class="thank-you" id="receiptThankYouMessage">
                        Thank you for your patronage!
                    </div>
                    
                    <div class="signatures">
                        <div class="signature-box">
                            <img src="" alt="Authorized Signature" class="signature-img" id="receiptAuthorizedSignature">
                            <div class="signature-line"></div>
                            <p>Authorized Signature</p>
                            <p id="receiptAuthorizedName"></p>
                        </div>
                        
                        <div class="signature-box">
                            <img src="" alt="Customer Signature" class="signature-img" id="receiptCustomerSignature">
                            <div class="signature-line"></div>
                            <p>Customer Signature</p>
                        </div>
                    </div>

                    <div class="account-cards" id="accountCardsContainer">
                        <div class="account-card" id="accountCard1">
                            <h5>Account Details</h5>
                            <p><strong>Account Name:</strong> <span id="receiptAccountName1"></span></p>
                            <p><strong>Account Number:</strong> <span id="receiptAccountNumber1"></span></p>
                            <p><strong>Bank:</strong> <span id="receiptBankName1"></span></p>
                        </div>
                    
                        <div class="account-card" id="accountCard2">
                            <h5>Account Details</h5>
                            <p><strong>Account Name:</strong> <span id="receiptAccountName2"></span></p>
                            <p><strong>Account Number:</strong> <span id="receiptAccountNumber2"></span></p>
                            <p><strong>Bank:</strong> <span id="receiptBankName2"></span></p>
                        </div>
                    </div>


                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Initialize date with current date and time
            const now = new Date();
            const formattedDateTime = now.toISOString().slice(0, 16);
            document.getElementById('transactionDate').value = formattedDateTime;

            // Add first product row by default
            addProductRow();

            // Event listeners
            document.getElementById('addProductBtn').addEventListener('click', addProductRow);
            document.getElementById('updateReceiptBtn').addEventListener('click', updateReceipt);
            document.getElementById('printReceiptBtn').addEventListener('click', printReceipt);

            // Handle file uploads
            setupFileUpload('companyLogo', 'receiptCompanyLogo');
            setupFileUpload('authorizedSignature', 'receiptAuthorizedSignature');
            setupFileUpload('customerSignature', 'receiptCustomerSignature');

            // Initialize receipt
            updateReceipt();
        });

        // Function to format numbers with commas as thousands separators
        function formatNumber(number) {
            return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function setupFileUpload(inputId, imgId) {
            const input = document.getElementById(inputId);
            input.addEventListener('change', function (e) {
                if (e.target.files && e.target.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function (event) {
                        document.getElementById(imgId).src = event.target.result;
                    };
                    reader.readAsDataURL(e.target.files[0]);
                }
            });
        }

        function addProductRow() {
            const productsList = document.getElementById('productsList');
            const rowIndex = productsList.children.length;

            const row = document.createElement('tr');
            row.className = 'product-row';
            row.innerHTML = `
                <td>
                    <input type="text" class="form-control product-name" placeholder="Product name">
                </td>
                <td>
                    <textarea class="form-control product-description" rows="1" placeholder="Description"></textarea>
                </td>
                <td>
                    <input type="text" class="form-control product-quantity" placeholder="Qty" value="1" oninput="updateProductTotal(this)">
                </td>
                <td class="cost-input-container">
                    <input type="text" class="form-control product-cost" placeholder="0.00" oninput="updateProductTotal(this)">
                </td>
                <td>
                    <span class="product-total naira">0.00</span>
                </td>
                <td class="product-actions">
                    <button type="button" class="btn btn-sm btn-danger" onclick="removeProductRow(this)">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;

            productsList.appendChild(row);
        }

        function removeProductRow(button) {
            const row = button.closest('tr');
            row.remove();
            calculateTotals();
        }

        
        function updateProductTotal(input) {
            const row = input.closest('tr');
            const quantityInput = row.querySelector('.product-quantity');
            const costInput = row.querySelector('.product-cost');
            const totalSpan = row.querySelector('.product-total');

            // Extract numbers only from inputs
            const quantity = extractNumber(quantityInput.value) || 0;
            const cost = extractNumber(costInput.value) || 0;

            // For quantity, we'll keep the original text input but use the extracted number for calculations
            // Don't update the quantityInput.value to preserve text like "5 boxes"

            // Update the cost input with formatted value
            costInput.value = formatNumber(cost);

            const total = quantity * cost;
            totalSpan.textContent = formatNumber(total.toFixed(2));

            calculateTotals();
        }

        function extractNumber(value) {
            // Extract only numbers from the input, removing commas
            const cleanValue = value.toString().replace(/,/g, '');
            // Match the first sequence of digits (possibly with a decimal point)
            const matches = cleanValue.match(/\d*\.?\d+/);
            if (matches && matches.length > 0) {
                return parseFloat(matches[0]);
            }
            return 0;
        }

        function calculateTotals() {
            const rows = document.querySelectorAll('.product-row');
            let subtotal = 0;

            rows.forEach(row => {
                const totalText = row.querySelector('.product-total').textContent;
                subtotal += extractNumber(totalText) || 0;
            });

            // Get VAT rate as a percentage
            const vatRateInput = document.getElementById('vatRate').value.trim();
            const vatRate = vatRateInput ? parseFloat(vatRateInput) : 0;

            // Calculate VAT amount based on percentage of subtotal, only if input is provided
            const vat = vatRateInput ? (subtotal * vatRate) / 100 : 0;

            // Get payment terms percentage
            const paymentTermsInput = document.getElementById('paymentTermsAmount').value.trim();
            const paymentTermsPercentage = paymentTermsInput ? parseFloat(paymentTermsInput) : 0;

            // Calculate payment terms amount based on percentage of subtotal, only if input is provided
            const paymentTermsAmount = paymentTermsInput ? (subtotal * paymentTermsPercentage) / 100 : 0;

            // Calculate grand total (subtotal + VAT - payment terms amount)
            // Note: Payment terms amount is subtracted because it's typically a discount
            const grandTotal = subtotal + vat - paymentTermsAmount;

            // Update receipt values with formatted numbers
            document.getElementById('receiptSubtotal').textContent = formatNumber(subtotal.toFixed(2));
            document.getElementById('receiptVat').textContent = formatNumber(vat.toFixed(2));
            document.getElementById('receiptPaymentTermsAmount').textContent = formatNumber(paymentTermsAmount.toFixed(2));
            document.getElementById('receiptGrandTotal').textContent = formatNumber(grandTotal.toFixed(2));

            // Update the payment terms label to show the percentage if provided
            if (paymentTermsInput) {
                const paymentTermsLabel = document.querySelector('#paymentTermsAmountContainer .label');
                if (paymentTermsLabel) {
                    paymentTermsLabel.textContent = `Payment Terms (${paymentTermsPercentage}%):`;
                }
            }

            // Update the VAT label to show the percentage if provided
            if (vatRateInput) {
                const vatLabel = document.querySelector('#vatContainer .label');
                if (vatLabel) {
                    vatLabel.textContent = `VAT (${vatRate}%):`;
                }
            }
        }


        function updateReceipt() {
            // Company information
            updateTextContent('companyName', 'receiptCompanyName');

            // Special handling for company address to ensure proper wrapping
            const companyAddress = document.getElementById('companyAddress').value;
            const receiptCompanyAddress = document.getElementById('receiptCompanyAddress');
            receiptCompanyAddress.textContent = companyAddress;
            receiptCompanyAddress.style.whiteSpace = 'pre-line';
            receiptCompanyAddress.style.wordWrap = 'break-word';
            receiptCompanyAddress.style.maxWidth = '250px';

            updateTextContent('companyPhone', 'receiptCompanyPhone');
            updateTextContent('companyEmail', 'receiptCompanyEmail');
            updateTextContent('companyWebsite', 'receiptCompanyWebsite');

            // Recipient information
            updateTextContent('recipientName', 'receiptRecipientName');

            // Special handling for recipient address to ensure proper wrapping
            const recipientAddress = document.getElementById('recipientAddress').value;
            const receiptRecipientAddress = document.getElementById('receiptRecipientAddress');
            receiptRecipientAddress.textContent = recipientAddress;
            receiptRecipientAddress.style.whiteSpace = 'pre-line';
            receiptRecipientAddress.style.wordWrap = 'break-word';
            receiptRecipientAddress.style.maxWidth = '250px';

            // Receipt details
            const dateInput = document.getElementById('transactionDate');
            if (dateInput.value) {
                const date = new Date(dateInput.value);
                document.getElementById('receiptTransactionDate').textContent = date.toLocaleString();
            } else {
                document.getElementById('receiptTransactionDate').textContent = new Date().toLocaleString();
            }

            updateTextContent('receiptNumber', 'receiptReceiptNumber');

            // L.O.P Number (optional)
            const lopNumber = document.getElementById('lopNumber').value;
            document.getElementById('receiptLopNumber').textContent = lopNumber;
            document.getElementById('lopNumberContainer').style.display = lopNumber ? 'block' : 'none';

            // Account details
            updateTextContent('accountName1', 'receiptAccountName1');
            updateTextContent('accountNumber1', 'receiptAccountNumber1');
            updateTextContent('bankName1', 'receiptBankName1');

            updateTextContent('accountName2', 'receiptAccountName2');
            updateTextContent('accountNumber2', 'receiptAccountNumber2');
            updateTextContent('bankName2', 'receiptBankName2');

            // Hide account cards if empty
            const accountCard1 = document.getElementById('accountCard1');
            const hasAccount1 = document.getElementById('accountName1').value ||
                document.getElementById('accountNumber1').value ||
                document.getElementById('bankName1').value;
            accountCard1.style.display = hasAccount1 ? 'block' : 'none';

            const accountCard2 = document.getElementById('accountCard2');
            const hasAccount2 = document.getElementById('accountName2').value ||
                document.getElementById('accountNumber2').value ||
                document.getElementById('bankName2').value;
            accountCard2.style.display = hasAccount2 ? 'block' : 'none';

            // Hide account cards container if both are empty
            document.getElementById('accountCardsContainer').style.display =
                (hasAccount1 || hasAccount2) ? 'flex' : 'none';

            // Products
            updateProducts();

            // VAT - Handle as percentage
            const vatRateInput = document.getElementById('vatRate').value.trim();
            if (vatRateInput) {
                const vatRate = parseFloat(vatRateInput);
                document.getElementById('receiptVatRate').textContent = vatRate;
                document.getElementById('vatContainer').style.display = vatRate > 0 ? 'flex' : 'none';
            } else {
                document.getElementById('vatContainer').style.display = 'none';
            }

            // Payment terms
            const paymentTerms = document.getElementById('paymentTerms').value;
            const receiptPaymentTerms = document.getElementById('receiptPaymentTerms');
            receiptPaymentTerms.textContent = paymentTerms;
            receiptPaymentTerms.style.whiteSpace = 'pre-line';
            receiptPaymentTerms.style.wordWrap = 'break-word';
            document.getElementById('paymentTermsContainer').style.display = paymentTerms ? 'block' : 'none';

            // Payment terms amount - Handle as percentage
            const paymentTermsInput = document.getElementById('paymentTermsAmount').value.trim();
            if (paymentTermsInput) {
                const paymentTermsPercentage = parseFloat(paymentTermsInput);
                document.getElementById('paymentTermsAmountContainer').style.display =
                    paymentTermsPercentage > 0 ? 'flex' : 'none';
            } else {
                document.getElementById('paymentTermsAmountContainer').style.display = 'none';
            }

            // Thank you message
            updateTextContent('thankYouMessage', 'receiptThankYouMessage');

            // Authorized name
            updateTextContent('authorizedName', 'receiptAuthorizedName');

            // Handle signatures - hide if not uploaded
            const authorizedSignatureImg = document.getElementById('receiptAuthorizedSignature');
            const customerSignatureImg = document.getElementById('receiptCustomerSignature');

            // Get the signature box containers
            const authorizedSignatureBox = authorizedSignatureImg.closest('.signature-box');
            const customerSignatureBox = customerSignatureImg.closest('.signature-box');

            // Hide signature boxes if no image is uploaded (src is empty)
            if (!authorizedSignatureImg.src || authorizedSignatureImg.src === window.location.href) {
                authorizedSignatureBox.style.display = 'none';
            } else {
                authorizedSignatureBox.style.display = 'block';
            }

            if (!customerSignatureImg.src || customerSignatureImg.src === window.location.href) {
                customerSignatureBox.style.display = 'none';
            } else {
                customerSignatureBox.style.display = 'block';
            }

            // Hide the entire signatures container if both signatures are missing
            const signaturesContainer = document.querySelector('.signatures');
            if (authorizedSignatureBox.style.display === 'none' && customerSignatureBox.style.display === 'none') {
                signaturesContainer.style.display = 'none';
            } else {
                signaturesContainer.style.display = 'flex';
            }

            // Apply table layout settings to ensure proper column widths
            const receiptTable = document.querySelector('.receipt table');
            receiptTable.style.tableLayout = 'fixed';
            receiptTable.style.width = '100%';

            // Calculate totals
            calculateTotals();
        }


        function updateTextContent(inputId, outputId) {
            const value = document.getElementById(inputId).value;
            document.getElementById(outputId).textContent = value;
        }



        function updateProducts() {
            const receiptProductsList = document.getElementById('receiptProductsList');
            receiptProductsList.innerHTML = '';

            const productRows = document.querySelectorAll('.product-row');

            productRows.forEach(row => {
                const productName = row.querySelector('.product-name').value;
                const productDescription = row.querySelector('.product-description').value;
                const productQuantity = row.querySelector('.product-quantity').value; // Keep original text
                const productCost = extractNumber(row.querySelector('.product-cost').value);
                const productTotal = extractNumber(row.querySelector('.product-total').textContent);

                if (productName || productDescription) {
                    const newRow = document.createElement('tr');

                    // Create individual cells to better control their content
                    const nameCell = document.createElement('td');
                    nameCell.textContent = productName;

                    const descCell = document.createElement('td');
                    descCell.textContent = productDescription;
                    descCell.style.whiteSpace = 'pre-line';
                    descCell.style.wordWrap = 'break-word';
                    descCell.style.maxWidth = '200px';

                    const qtyCell = document.createElement('td');
                    qtyCell.textContent = productQuantity;

                    const costCell = document.createElement('td');
                    costCell.className = 'naira';
                    costCell.textContent = formatNumber(productCost.toFixed(2));

                    const totalCell = document.createElement('td');
                    totalCell.className = 'naira';
                    totalCell.textContent = formatNumber(productTotal.toFixed(2));

                    // Append all cells to the row
                    newRow.appendChild(nameCell);
                    newRow.appendChild(descCell);
                    newRow.appendChild(qtyCell);
                    newRow.appendChild(costCell);
                    newRow.appendChild(totalCell);

                    receiptProductsList.appendChild(newRow);
                }
            });
        }



        function printReceipt() {
            window.print();
        }
    </script>
</body>

</html>

